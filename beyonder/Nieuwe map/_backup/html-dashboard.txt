<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFServices · Client Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Rajdhani:wght@300;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Helper voor niet-blokkerende meldingen (vervangt alert())
        function uiNotify(message, type = 'success') {
            const msg = document.createElement('div');
            msg.textContent = message;
            // Tailwind classes voor esthetiek
            msg.className = 'fixed bottom-4 right-4 z-50 p-3 rounded-lg text-sm transition-all duration-300 font-medium tracking-wide shadow-xl';
            msg.style.backgroundColor = type === 'success' ? '#059669' : (type === 'error' ? '#dc2626' : '#f59e0b'); // emerald-600 / red-600 / amber-500
            msg.style.color = '#ffffff';
            document.body.appendChild(msg);
            setTimeout(() => document.body.removeChild(msg), 3000);
        }
        
        // LOGOUT FIX: Redirect naar login.html (niet index.html)
        function logout() { 
            sessionStorage.removeItem("z3ro_session"); 
            sessionStorage.removeItem("current_client_code"); // Verwijder ook de hint
            window.location.href = "login.html"; // FIX: Vereenvoudigd naar simpele bestandsnaam
        }

        if (!sessionStorage.getItem("z3ro_session")) console.log("Z3RO: Geen sessie (Demo Modus)");
    </script>
</head>
<body class="min-h-screen flex flex-col bg-slate-950 text-slate-50" style="font-family: 'Rajdhani', sans-serif; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;">

    <nav class="border-b border-slate-800 bg-slate-950/80 backdrop-blur-md sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="font-bold text-xl tracking-wider text-white" style="font-family: 'Orbitron', sans-serif;">CF<span class="text-sky-500">SERVICES</span></div>
                <span class="px-2 py-0.5 rounded text-[10px] bg-slate-800 text-slate-400 border border-slate-700 uppercase tracking-widest">Client Portal</span>
            </div>
            <div class="flex items-center space-x-4">
                <span id="client-code-display" class="text-xs text-slate-400 font-mono hidden md:block">CODE: N/A</span>
                <button onclick="logout()" class="px-4 py-2 text-xs font-semibold bg-red-600 hover:bg-red-500 rounded transition uppercase">
                    UITLOGGEN
                </button>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-6 py-8">
        <header class="mb-10 flex flex-col md:flex-row justify-between items-end gap-4">
            <div><h1 class="text-3xl text-white font-bold mb-1" style="font-family: 'Orbitron', sans-serif;">Systeem Overzicht</h1><p class="text-slate-400">Welkom in uw beveiligde omgeving.</p></div>
            <div class="flex items-center gap-2 text-sm text-emerald-400 bg-emerald-950/30 px-3 py-1 rounded-full border border-emerald-900/50">● Z3RO Audit Layer Active</div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            
            <div class="bg-slate-900/60 border border-slate-800 p-6 rounded-2xl relative overflow-hidden backdrop-blur-sm">
                <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-2">Huidig Verbruik</h3>
                <div class="text-4xl font-bold text-white mb-1" style="font-family: 'Orbitron', sans-serif;">$ 156.00</div>
                <div class="text-sm text-sky-400 font-bold">12 uur @ $13/hr</div>
                <div class="mt-4 w-full bg-slate-800 rounded-full h-1.5"><div class="bg-sky-500 h-1.5 rounded-full shadow-[0_0_10px_#38bdf8]" style="width: 45%"></div></div>
            </div>

            <div class="bg-slate-900/60 border border-slate-800 p-6 rounded-2xl backdrop-blur-sm">
                <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-4">Actieve Services</h3>
                <ul class="space-y-3">
                    <li class="flex justify-between items-center pb-2 border-b border-slate-800">
                        <span class="text-slate-200">Server Monitoring</span>
                        <span class="text-emerald-400 text-xs px-2 py-1 bg-emerald-950 rounded border border-emerald-900">ONLINE</span>
                    </li>
                    <li class="flex justify-between items-center pb-2 border-b border-slate-800">
                        <span class="text-slate-200">Aetron AI Access</span>
                        <span class="text-emerald-400 text-xs px-2 py-1 bg-emerald-950 rounded border border-emerald-900">ONLINE</span>
                    </li>
                    <li class="flex justify-between items-center">
                        <span class="text-slate-200">Security Patching</span>
                        <span class="text-sky-400 text-xs px-2 py-1 bg-sky-950 rounded border border-sky-900">PENDING</span>
                    </li>
                </ul>
            </div>

            <div class="bg-slate-900/60 border border-slate-800 p-6 rounded-2xl flex flex-col justify-start gap-4 backdrop-blur-sm">
                <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-2">Directe Acties</h3>

                <a href="../2-aetron/manifest.html" class="w-full bg-violet-600 hover:bg-violet-500 text-white font-bold py-3 rounded transition-all shadow-lg flex items-center justify-center gap-2 group">
                    <span style="font-family: 'Orbitron', sans-serif;">OPEN AETRON</span> →
                </a>

                <label for="file-upload" class="cursor-pointer w-full bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-300 font-medium py-3 rounded transition hover:text-white flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                    Upload Document
                </label>
                <input type="file" id="file-upload" class="hidden" onchange="handleUpload(this)">

                <div id="upload-status" class="hidden w-full bg-slate-950 rounded border border-slate-800 p-2">
                    <div class="flex justify-between text-xs text-sky-400 mb-1">
                        <span class="animate-pulse">Encrypting...</span><span id="upload-percent">0%</span>
                    </div>
                    <div class="w-full bg-slate-800 h-1 rounded-full"><div id="upload-bar" class="bg-sky-500 h-1 rounded-full transition-all duration-300" style="width: 0%"></div></div>
                </div>

                <button onclick="downloadAudit('Factuur')" class="w-full bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-300 font-medium py-3 rounded transition hover:text-white flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    Download Factuur
                </button>
            </div>
        </div>

        <section class="mt-8 bg-slate-900/60 border border-slate-800 p-6 rounded-2xl backdrop-blur-sm shadow-xl">
            <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-3 flex items-center gap-2">
                <svg class="w-4 h-4 text-sky-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                Visual Intelligence Engine
                <span class="text-[10px] px-2 py-0.5 bg-sky-900/40 border border-sky-800 rounded uppercase text-sky-300">Omniscience v2.1</span>
            </h3>

            <div class="flex gap-3 mb-4">
                <input id="vie-input" type="text" placeholder="Stel een vraag... (bv. Wie is de president van Suriname?)" 
                       class="flex-1 bg-slate-950 border border-slate-700 rounded px-4 py-3 text-sm text-slate-200 focus:outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500/50 transition">
                <button onclick="runVIE()" class="px-6 py-2 bg-sky-600 hover:bg-sky-500 text-white rounded font-bold transition shadow-lg shadow-sky-500/20" style="font-family: 'Orbitron', sans-serif;">
                    SCAN →
                </button>
            </div>

            <div id="vie-output" class="hidden mt-4 p-6 bg-slate-950/80 border border-slate-800 rounded-lg shadow-inner">
                <div class="mb-4">
                    <div id="vie-persona" class="text-xs uppercase tracking-widest text-sky-400 mb-2 font-bold border-b border-slate-800 pb-2"></div>
                    <div id="vie-answer" class="text-slate-300 whitespace-pre-wrap leading-relaxed text-sm"></div>
                </div>
                <div id="vie-images" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mt-6"></div>
                <div id="vie-sources" class="mt-6 pt-4 border-t border-slate-800 text-[10px] text-slate-500 font-mono"></div>
            </div>
        </section>

        <div class="mt-8 bg-slate-900/60 p-6 rounded-2xl border border-slate-800 shadow-xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-slate-400 text-sm uppercase tracking-wider">Z3RO Audit Logs</h3>
                <span class="text-[10px] text-slate-500 font-mono">ID: CSE108-35</span>
            </div>
            <div class="overflow-x-auto rounded-lg border border-slate-800">
                <table class="w-full text-left text-sm text-slate-400">
                    <thead class="text-xs uppercase bg-slate-900 text-slate-300">
                        <tr><th class="px-4 py-3">Tijdstempel</th><th class="px-4 py-3">Actie</th><th class="px-4 py-3">Gebruiker</th><th class="px-4 py-3 text-right">Status</th></tr>
                    </thead>
                    <tbody class="divide-y divide-slate-800 bg-slate-900/30">
                        <tr class="hover:bg-slate-800/50"><td class="px-4 py-3 font-mono text-sky-500">2025-11-30 19:42:11</td><td>Login Success</td><td>admin@groeisamen.nv</td><td class="px-4 py-3 text-right text-emerald-500">Verified</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

    </main>

    <footer class="mt-12 py-6 text-center text-xs text-slate-600 border-t border-slate-800">
        <p>&copy; 2025 CFServices International | Z3RO Protocol Actief | Lineage Verankerd</p>
    </footer>

    <script>
        // Functie voor Audit Download (gebruikt uiNotify)
        function downloadAudit(reportName) {
            if (reportName.includes("Draft")) {
                uiNotify(`❌ Toegang geweigerd. Rapport "${reportName}" is nog in Transitie en kan niet worden geactiveerd.`, 'error');
            } else {
                uiNotify(`✅ Rapport "${reportName}" geactiveerd. Download gestart.`, 'success');
            }
        }
        
        // Functie om de Client Code te tonen
        function initializeDashboard() {
            const clientCode = sessionStorage.getItem("current_client_code");
            const codeDisplay = document.getElementById("client-code-display");

            if (clientCode) {
                codeDisplay.textContent = `CODE: ${clientCode}`;
                codeDisplay.classList.remove("hidden");
                document.getElementById("client-role").textContent = `Agent ${clientCode.substring(4)}`;
            }

            // Redirect naar login.html als er geen sessie is
            if (!sessionStorage.getItem("z3ro_session")) {
                 window.location.href = "../1-luxen/login.html"; // FIX: Absoluut pad naar de map
            }
        }
        
        // --- UPLOAD LOGIC ---
        function handleUpload(input) {
            if (input.files && input.files[0]) {
                const status = document.getElementById('upload-status');
                const bar = document.getElementById('upload-bar');
                const percent = document.getElementById('upload-percent');
                
                status.classList.remove('hidden');
                
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    bar.style.width = progress + '%';
                    percent.innerText = progress + '%';
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        percent.innerText = "VERIFIED";
                        percent.classList.replace('text-sky-400', 'text-emerald-400');
                        bar.classList.replace('bg-sky-500', 'bg-emerald-500');
                        setTimeout(() => {
                            uiNotify("Document veilig ontvangen in Z3RO Vault.", 'success');
                            status.classList.add('hidden');
                            bar.style.width = '0%';
                            percent.innerText = '0%';
                            percent.classList.replace('text-emerald-400', 'text-sky-400');
                            bar.classList.replace('bg-emerald-500', 'bg-sky-500');
                        }, 1000);
                    }
                }, 150);
            }
        }

        // --- VIE LOGIC ---
        async function runVIE() {
            const q = document.getElementById("vie-input").value.trim();
            if (!q) return uiNotify("Typ eerst een vraag, Generaal.", 'warning');

            const out = document.getElementById("vie-output");
            const personaEl = document.getElementById("vie-persona");
            const answerEl = document.getElementById("vie-answer");
            const imgGrid = document.getElementById("vie-images");
            const srcEl = document.getElementById("vie-sources");

            out.classList.remove("hidden");
            answerEl.innerHTML = '<span class="text-sky-400 animate-pulse">⏳ Aetron scant live bronnen...</span>';
            personaEl.textContent = "INITIALIZING...";
            imgGrid.innerHTML = "";
            srcEl.innerHTML = "";

            try {
                const res = await fetch("../api/aetron/scan", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ query: q })
                });

                const data = await res.json();
                personaEl.textContent = `${data.persona.toUpperCase()} · ${data.role}`;
                
                let cleanOutput = data.output.replace(/!\[.*?\]\(.*?\)/g, ""); 
                answerEl.textContent = cleanOutput;

                if (data.images && data.images.length > 0) {
                    data.images.slice(0, 4).forEach(url => {
                        const a = document.createElement("a");
                        a.href = url; a.target = "_blank";
                        a.className = "block group relative overflow-hidden rounded-lg border border-slate-700 hover:border-sky-500 transition aspect-video bg-slate-900";
                        const img = document.createElement("img");
                        img.src = url; img.className = "object-cover w-full h-full opacity-80 group-hover:opacity-100 transition duration-500 group-hover:scale-110";
                        img.onerror = function() { this.style.display = 'none'; };
                        a.appendChild(img);
                        imgGrid.appendChild(a);
                    });
                }

                if (data.sources?.length) {
                    srcEl.innerHTML = "<b class='text-slate-400'>BRONNEN:</b><br>" + data.sources.map(s => `• <a href="${s}" target="_blank" class="text-sky-600 hover:text-sky-400 transition underline decoration-sky-900">${new URL(s).hostname}</a>`).join(" ");
                }

            } catch (e) {
                answerEl.textContent = "⚠️ Systeemfout. Check API.";
                console.error(e);
            }
        }

        document.addEventListener('contextmenu', event => event.preventDefault());
        document.getElementById('vie-input').addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                runVIE();
            }
        });
        
        // Roep deze aan bij het laden
        initializeDashboard();
    </script>
</body>
</html>